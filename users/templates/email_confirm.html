{% extends "layout.html" %}
{% load static i18n  %}

{% block title %} Подтверждение E-mail {% endblock %}

{% block extrahead %}
{% endblock %}


{% block body %}
<div class="modal fade" id="sendMailSuccess">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title w-100 text-center">Регистрация</h5>
          <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button> -->
        </div>
  
        <div class="modal-body">
          <h4 class="text-center">
            <i class="fa fa-check" style="color:#008000"></i>
            <span>Письмо успешно отправлено!</span>
          </h4>
        </div>
  
        <div class="modal-footer">
          <button type="button" class="btn btn-success mx-auto" data-dismiss="modal">ОК</button>
        </div>
      </div>
    </div>
  </div>
<div class="container mt-3 py-3">
    
    <!-- Errors -->
    {% if form.errors %}
    <div class="alert alert-danger">
        <button type="button" class="close" data-dismiss="alert">×</button>
        {% for field in form %}
            {% if field.errors %}
                <li>{{ field.errors|striptags }}</li>
            {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    <!-- Main -->
    {% if user.email_confirmed%}
        <h2 class="text-center my-5">Email уже подтвержден</h2>
        <div class="bnts">
            <a href="/" class="btn btn-primary">На главную</a>
        </div>
    {% elif "incorrect" in request.GET%}
        <h2 class="text-center my-5">Изменить Email</h2>
        <form action="" method="post" style="max-width:500px" class="mx-auto my-3">
            {% csrf_token %}
            <div class="form-group mb-3">
                <label>Старый Email</label>
                <span class="h5">{{email}}</span>
            </div>

            <div class="form-group mb-3">
                <label>Новый Email:</label>
                <input type="email" name="email" placeholder="email@gmail.com" class="form-control">
                <div class="text-center">
                    <input type="submit" value="Изменить Email" class="btn btn-success my-3">
                </div>
            </div>
        </form>
    {% elif email and user %}
        <h2 class="text-center my-5">Подтверждение Email</h2>
        <h4 class="text-center">Откройте письмо, которое пришло на ваш Email <span class="text-primary">{{email}}</span></h4>
        <h5 class="text-center">
            <a href="?incorrect">Неверный email?</a>
            <span class="mx-2">|</span>
            <a href="?resend">Повторная отправка</a>
        </h5>
    {% else %}
        <h2 class="text-center my-5">Ошибка подтверждения Email</h2>
        <h3 class="text-center">Обратитесь в техподдержку</h3>
        <h4 class="text-center">E:{{email}};U:{{user.id}};UC:{{user.email_confirmed}}</h4>
    {% endif %}
</div>
{% endblock %}


{% block extrabody %}
<script>
    if (location.hash == "#sended"){
        $('#sendMailSuccess').modal('show')
        location.hash = ""
    }
</script>
{% endblock %}